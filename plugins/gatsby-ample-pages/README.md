# gatsby-ample-pages

This plugin's goal is to provide a flexible and extendible means of building out dynamic page layouts, with CMS support (or not), without needing to touch the underlying logic.

It relies heavily on the existence of other files and plugins within the project. In particular, these are the requirements:

- The `gatsby-ample-seo` plugin (local) is used for normalizing and rendering SEO.
- It expects an object to be exported as `layouts` from `src/templates/page/index.js`. (More on this below.)
- It uses the `allPages` and `page` queries generated by both `gatsby-remark-ample`, which makes use of the `model` field on files within the `src/content/pages` directory. See `gatsby-remark-ample` for more information.
- A defined fragment `PageAttributes` on type `Page`. This ships with the starter at `src/fragments/page-attributes.js`.

## Usage

This plugin is enabled by default in the starter kit. To disable, simply remove `gatsby-ample-pages` from the `plugins` array in `gatsby-config.js` at the root of the project. Conversely, you can add it back if it's been disabled and you'd like to use it.

Note that, at this time, there is no ability to customize how this component works through plugin options.

## How it Works

The `gatsby-node.js` file in this plugin uses the `allPages` query (built from local configuration and the `gatsby-remark-ample` plugin) to gather a list of pages. Based on our typical configuration, these files are likely all be in the `src/content/pages` directory.

It looks through those pages and determines a path at which they should be built. This is determined as the file structure within their content directory (i.e. `src/content/pages`). Therefore, nesting URLs is as simple as nesting the page within the directory.

The page is then passed on to a component adapter, which lives in this plugin at `src/templates/page/adapter.js`. Instead of writing the page's attributes directly in the adapter, it relies on a `PageAttributes` fragment to be defined elsewhere in the project.

That adapter file is heavily documented, but the gist is that, for any given page, it goes through these steps:

1. Look for a `layout` field to determine the page's layout.
2. Destructure an object named for that field as `layout_[name]`, e.g. if the layout is `basic`, then look for a `layout_basic` object on the page to pass to the layout component.
3. Use the `layouts` named export in the source project's `src/templates/page/index.js` file to determine the proper React component to use to render the page.
4. Pass the data onto that layout.

The idea here is that we are simply _wrapping_ static templates from the source project, such that the source project can be developed outside the context of dynamic pages.

### Publishing Workflow

The pages plugin also supports a published/draft mode on pages. Pages have a `published` field on them. To have unpublished pages ignored, set a `GATSBY_PAGES_PUBLISH_MODE` environment variable to some truthy value. Otherwise, all pages will be rendered.
